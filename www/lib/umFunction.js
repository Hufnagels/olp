var openedClass="icon-eye-close opener";var closedClass="icon-eye-open opener";var scrollContainerHeight=425;var scrollContainerInnerHeight=350;var selectedClass="selectedElement";var xpos;var ypos;var $optionSet=$("#sortBy");var ascOrder=true;var currentFilter,sortValue;(function(m,f,g){var o={userForm:document.getElementById("usersform")||"",newUserform:f("#newuser"),myUsers:document.getElementById("myUsersList")||"",addUserButton:document.getElementById("addUserButton")||"",$addUserAction:f("#addUser").find("li.action a")||"",upload:document.getElementById("upload")||"",fileupload:document.getElementById("fileupload")||"",selectionMenu:document.getElementById("selectionMenu")||"",select:function(B){switch(B.attr("class")){case"selectall":f(o.myUsers).find("li.rootClass:not(.hiddenClass, .hidden)").addClass("selected");break;case"deselectall":f(o.myUsers).find("li.rootClass:not(.hiddenClass, .hidden)").removeClass("selected");break;case"invertselection":f(o.myUsers).find("li.rootClass:not(.hiddenClass, .hidden)").toggleClass("selected");break}e.countSelected();e.addDND()}},z={input:document.getElementById("newDepartmentName")||"",addButton:document.getElementById("addNewDepartment")||"",departmentList:document.getElementById("usersGroupList")||"",container:document.getElementById("myusersGroupsContainer")||"",row:[]},x={input:document.getElementById("newGroupName")||"",addButton:document.getElementById("addNewGroup")||"",groupList:document.getElementById("trainingGroupList"),container:document.getElementById("myOptionsContainer")||"",row:[]},a={buttonGroup:document.getElementsByClassName("optionButtons")||"",selectedCount:document.getElementById("selectedCount")||"",$optionButton:f(".optionButtons").find("button")||"",init:function(){this.$optionButton.bind("click",function(){if(f(this).hasClass("disabled")){return false}var C=f(this).attr("data-option-value");var B=[];f(o.myUsers).find("li.rootClass.selected:not(.hiddenClass, .hidden)").each(function(){B.push(f(this).attr("id"))});e.setAction(C,B);f(o.myUsers).find("li.rootClass.selected").removeClass("selected");e.countSelected()})}},u={$sortbyButtons:f("#sortBy > button")||"",$wordFilterButton:f("#filterWord")||"",$orderButtons:f("#sortOrder")||"",$filterButton:f("#filterByIA > button")||"",order:"asc",init:function(){this.$wordFilterButton.bind("keyup",function(){if(f(this).val().length<2){f(o.myUsers).find("li.rootClass").removeClass("hidden");return false}var B=f(this).val().toLowerCase();f(o.myUsers).find("li.rootClass").filter(function(){return f(this).attr("data-name").toLowerCase().indexOf(B)==-1}).addClass("hidden");u.sort()});this.$filterButton.bind("click",function(D){D.preventDefault();f(this).hasClass("active")?f(this).removeClass("active"):f(this).addClass("active");var B=".colorBar."+f(this).attr("data-option-value");var C=f(o.myUsers).find("li.rootClass").find("div"+B).parent();C.toggleClass("hidden");u.sort()});f("#sortBy > button").bind("click",function(B){B.preventDefault();f("#sortBy").find("button").removeClass("active");f(this).addClass("active");u.sort()});f("#sortOrder > button").bind("click",function(B){B.preventDefault();f("#sortOrder").find("button").removeClass("active");f(this).addClass("active");u.sort()});u.sort()},sort:function(){f("#detailRow").remove();var D=f("#sortBy").find(".btn.active").attr("data-option-value");var B=f("#sortOrder").find(".btn.active").attr("data-option-value");var C=[];u.$filterButton.filter(function(){return !f(this).hasClass("active")}).each(function(){C.push("colorBar "+f(this).attr("data-option-value"))});f(o.myUsers).find("li.rootClass > .colorBar").filter(function(){return C.indexOf(this.className)!==-1}).parent().addClass("hidden");f(o.myUsers).find("li.rootClass:not(.hiddenClass, .hidden)").tsort({attr:"data-"+D,order:B});f(o.myUsers).find("li.rootClass.hiddenClass, li.rootClass.hidden").appendTo(o.myUsers)}},n=[],y=[],w=[],A=[],h=[],i=[],b={},v={url:"",data:b,responseType:"json"},k={department:{0:"load",1:"delete",2:"rename",3:"new",4:"addto",5:"removefrom"},groups:{0:"load",1:"delete",2:"rename",3:"new",4:"addto",5:"removefrom"},users:{0:"load",1:"delete",2:"update",3:"new",4:"activate",5:"deactivate",6:"loadone",7:"changeData"}},c=0,r={fastMessage:document.getElementsByClassName("fastMessage")[0],sendfastMessageButton:document.getElementById("sendFastMessage"),init:function(){addEventO(this.sendfastMessageButton,"click",function(B){r.send(r.sendfastMessageButton)},true,_eventHandlers)},send:function(D){if(f(D).hasClass("disabled")){return false}var C=f(o.myUsers).find("li.selected");var E=[];C.each(function(F,G){E.push({id:f(G).attr("id")})});b={};b.form=f(o.userForm).serializeArray();b.message=r.fastMessage.value;b.users=E;b.action="fastmessage";v.data=b;var B=sendEmail(b,v);if(B.type=="success"){r.fastMessage.value=""}return false}},q={0:z.input,1:x.input},s={0:z.container,1:x.container},l=1,j={isLazy:false,regEx:{characterReg:/^\s*[a-zA-Z0-9,\s]+\s*$/,emailExp:/^[^\s()<>@,;:\/]+@\w[\w\.-]+\.[a-z]{2,}$/i}};var e={index:1,init:function(){this.setUserAction();this.upload();o.$addUserAction.each(function(){addEventO(this,"click",function(){e.userAdd(f(this).attr("data-action"))},true,_eventHandlers)})},userAdd:function(D){switch(D){case"one":var C=[];C.result=[];C.result.push();var B=tmpl("tmpl-individuser",C);f("#confirmDiv").confirmModal({heading:"Add individual user",body:B,text:"Add new user",page:"users",cancel:true,callback:function(){if(!j.regEx.emailExp.test(f('[name="email"]').val())){f('[name="email"]').closest(".control-group").addClass("error")}else{f('[name="email"]').closest(".control-group").removeClass("error")}if(!j.regEx.characterReg.test(f('[name="vezeteknev"]').val())){f('[name="vezeteknev"]').closest(".control-group").addClass("error")}else{f('[name="vezeteknev"]').closest(".control-group").removeClass("error")}if(!j.regEx.characterReg.test(f('[name="keresztnev"]').val())){f('[name="keresztnev"]').closest(".control-group").addClass("error")}else{f('[name="keresztnev"]').closest(".control-group").removeClass("error")}if(o.newUserform.find(".error").length>0){return false}b={};b.action="new",b.form=f(o.userForm).serializeArray();b.id=f("#newuser").serializeArray();v.url="/crawl?/process/users/handelusers/";v.data=b;var E=getJsonData(v);if(E.type=="success"){f("#confirmDiv").modal("hide");f(o.myUsers).prepend(tmpl("tmpl-users",E));u.sort()}d.init();return false}});break;case"any":f("#upload").trigger("click");return false;break}},userInlineEdit:function(B){f.fn.editable.defaults.url="/crawl?/process/users/handelusers/";f.fn.editable.defaults.params=function(C){C.action=k.users[7];C.form=f(o.userForm).serializeArray();return C};f("#email").editable({success:function(C,D){sendMessage("alert-"+C.type,C.message)}});f("#gender").editable({source:[{value:1,text:"Male"},{value:2,text:"Female"}],success:function(C,D){sendMessage("alert-"+C.type,C.message)}});f("#birth").editable({success:function(C,D){sendMessage("alert-"+C.type,C.message)}});f("#language").editable({source:[{value:"hungarian",text:"hungarian"},{value:"english",text:"english"},{value:"german",text:"german"},{value:"italian",text:"italian"},{value:"spanish",text:"spanish"}],success:function(C,D){sendMessage("alert-"+C.type,C.message)}});f("#userlevel").editable({source:[{value:3,text:"user"},{value:5,text:"editor (can't public)"},{value:7,text:"admin"}],success:function(C,D){sendMessage("alert-"+C.type,C.message)}});f(".myPass").editable({emptytext:"Not shown",send:"never"})},submitPassword:function(C){C.preventDefault();if(!f("#pwd").attr("data-pwd")||!f("#pwd2").attr("data-pwd")){sendMessage("alert-warning","Enter new password");return false}if(f("#pwd").attr("data-pwd")!==f("#pwd2").attr("data-pwd")){f(".help-block").html("Passwords must be the same").addClass("alert alert-error").show();return false}if(f("#pwd").attr("data-pwd").length<5){f(".help-block").html("Passwords must be min 5 chars").addClass("alert alert-error").show();return false}f(".help-block").hide();b={};b.action="changePassword";b.pk=f("#pwd").attr("data-pk");b.value=f("#pwd").attr("data-pwd");v.url="/crawl?/process/users/handelusers/";v.data=b;var B=getJsonData(v)},userDelete:function(C,B){f("#confirmDiv").confirmModal({heading:"Question",body:c?"Remove from training group?":"Delete user?",type:"question",text:c?"Remove":"Delete",cancel:true,callback:function(){if(c){C.url="/crawl?/process/users/handeltraininggroups/";C.data.action="removefrom";C.data.groupid=f(x.groupList).find("li.mediaBox.selected").attr("data-object-id")}else{C.url=C.data.action=="removefrom"?"/crawl?/process/users/handelgroups/":"/crawl?/process/users/handelusers/"}var D=getJsonData(C);B.each(function(){f(this).remove()});c?p.viewGroups():d.departmentView()}});return false},userSelect:function(B){B.toggleClass("selected");e.countSelected();e.addDND()},countSelected:function(){var B=f(o.myUsers).find("li.selected").length;f(a.selectedCount).text(B);B==0?f(r.sendfastMessageButton).addClass("disabled"):f(r.sendfastMessageButton).removeClass("disabled");B==0?a.$optionButton.addClass("disabled"):a.$optionButton.removeClass("disabled")},userView:function(){b={};b.action=k.users[0];b.form=f(o.userForm).serializeArray();b.from=j.isLazy?f(o.myUsers).find("li.userElement").length:-1;v.url="/crawl?/process/users/handelusers/";v.data=b;var C=getJsonData(v);if(!C.result){return false}f("#loading").show();for(var B=0;B<C.result.length;B++){n.push(parseInt(C.result[B].id))}f(o.myUsers).append(tmpl("tmpl-users",C));f("#loading").hide();this.setUserAction()},setUserAction:function(){i=calculateLIsInRow(o.myUsers);f(o.myUsers).find(".detailButton").live("click",function(E){E.preventDefault();var D=f(this).closest("li.rootClass");var F=D.attr("id");var C=f("#detailRow");if(C.length&&F==C.attr("data-detail-id")){f("span.icon-remove").trigger("click")}else{e.userDetailRow(D)}});f(o.myUsers).find(".selectButton").live("click",function(){var C=f(this).closest("li.rootClass");e.userSelect(C)});e.addDND();setTimeout(function(){f("#loading").hide()},100);var B=f(".userAction").find("li:not(.divider)");B.find("a").live("click",function(C){C.preventDefault();e.setAction(f(this).attr("data-action"),f(this).closest("li.rootClass").attr("id"))})},userDetailRow:function(D){var B=D;var F=parseInt(B.index()/i[1])+1;var C=B.position().left-B.parent().position().left+85+"px";b={};b.action=k.users[6],b.form=f(o.userForm).serializeArray(),b.id=B.attr("id");v.url="/crawl?/process/users/handelusers/";v.data=b;var E=getJsonData(v);if(!E.result){return false}f("#myDetailsLabel").text(D.find("span.name").text());f("#myDetails").find(".modal-body").html(tmpl("tmpl-userDetail",E));f("#myDetails").modal("show");e.userInlineEdit(f("#myDetails").find("form").attr("id"));f("#submit").live("click",function(G){G.preventDefault();e.submitPassword(G)})},upload:function(){f(o.fileupload).fileupload({url:"/crawl?/process/users/uploadusers/",acceptFileTypes:/(\.|\/)(csv)$/i,singleFileUploads:true,dataType:"json",uploadTemplateId:null,downloadTemplateId:null,start:function(C,B){f("#loading").show()},done:function(D,C){var B=C.result;if(B.result&&B.result.length>0){var C=[];C.result=[];C.result.push(B.users);f(o.myUsers).prepend(tmpl("tmpl-users",B));d.init()}f("#loading").hide();sendMessage("alert-"+B.type,B.message)}})},addDND:function(){var B=f(o.myUsers).find("li:data(draggable)");if(B.length>0){B.draggable("destroy")}f(o.myUsers).find("li.rootClass.selected").draggable(e.dragUser)},setAction:function(D,E){b={};b.form=f(o.userForm).serializeArray(),b.action=D,b.users=E;b.groupid="";v.url="/crawl?/process/users/handelusers/";v.data=b;var B=f(o.myUsers).find("li.rootClass.selected");if(B.length<2){B=f(o.myUsers).find('li[id="'+E+'"]')}if(D=="delete"||D=="removefrom"){e.userDelete(v,B);return false}else{var C=getJsonData(v);B.each(function(){f(this).find(".colorBar ").attr("class","colorBar "+D)});u.sort()}},newUserValidate:{rules:{keresztnev:"required",vezeteknev:"required",email:{required:true,email:true},neme:"required"},messages:{keresztnev:"Enter your last name",vezeteknev:"Enter your first name",email:{required:"Enter your email address",email:"Enter valid email address"},neme:"Select Gender"},errorClass:"help-inline",errorElement:"span",highlight:function(D,B,C){f(D).parents(".control-group").addClass("error")},unhighlight:function(D,B,C){f(D).parents(".control-group").removeClass("error");f(D).parents(".control-group").addClass("success")},submitHandler:function(C){b={};b.action="new",b.form=f(o.userForm).serializeArray();b.id=f("#newuser").serializeArray();v.url="/crawl?/process/users/handelusers/";v.data=b;var D=getJsonData(v);if(D.type=="success"){f("#confirmDiv").modal("hide");f(o.myUsers).prepend(tmpl("tmpl-users",D));u.sort()}d.init();return false;if(D.type=="success"){f("#confirmDiv").modal("hide");sendMessage("alert-"+response.message.type,response.message.message);f(o.myUsers).prepend(tmpl("tmpl-users",D));var B;if(D.group.id){switch(D.group.type){case"new":var E=um_handelUserGroups("load");$userGroupList.html(tmpl("tmpl-userGroupList",E));break;case"exist":B=$userGroupList.find('[data-object-id="'+response.group.id+'"]').find("span.badge");B.text(parseInt(B.text())+1);break}}else{B=$userGroupList.find('[data-object-name="notInList"]').find("span.badge");B.text(parseInt(B.text())+1);B=$userGroupList.find('[data-object-name="viewAll"]').find("span.badge");B.text(parseInt(B.text())+1)}}return false}},dragUser:{appendTo:"body",handle:".thumbnail",revert:true,greedy:true,opacity:0.7,helper:function(D,E){var C=f(o.myUsers).find("li.rootClass.selected");if(C.length===0||C.length===1){C=f(this)}if(f("#draggingContainer2").length===0){var B=f('<ul class="span2 userElement" />').appendTo("body").attr("id","draggingContainer2")}else{B=f("#draggingContainer2");B.empty()}B.append("<li><h1>"+C.length+" selected</h1></li>").css({position:"",left:"",top:"","z-index":"10000"});f("li",B).css({position:"",left:"",top:"","z-index":"10000"});return B},start:function(B,C){f("#draggingContainer2").css({position:"absolute"})},stop:function(B,C){var D=C.position;D=Math.abs(D.left)}}};var d={index:1,init:function(){f(z.input).preventEnter();this.departmentView();addEventO(z.addButton,"click",function(){var B={departmentName:z.input.value||"",post:"save"};d.addDepartment(B)},true,_eventHandlers)},addDepartment:function(C){if(C.departmentName===""){sendMessage("alert-warning","Give some text");return false}b={};b.action=k.department[3],b.form=f(o.userForm).serializeArray();b.groupname=C.departmentName;v.url="/crawl?/process/users/handelgroups/";v.data=b;var D=getJsonData(v);if(D.result.id){z.input.value="";var E=[];E.result=[];E.result.push({id:D.result.id,name:C.departmentName,doname:convertDoname(C.departmentName),badge:0});var B=tmpl("tmpl-newDepartment",E,true);f(z.departmentList).append(B);f(z.departmentList).find("li.mediaBox").tsort({attr:"data-object-name"});this.gatherDepartments()}},editDepartment:function(C){f.fn.editable.defaults.url="/crawl?/process/users/handelgroups/";f.fn.editable.defaults.params=function(D){D.action="rename";D.form=f(o.userForm).serializeArray();return D};var B=f(z.departmentList).find("li.selected");if(B.hasClass("viewAll")){return false}f(C).editable({success:function(D,E){if(E.match(/^\s+$/)===null&&E.length===0){sendMessage("alert-error","Give a name");return false}B.attr("data-object-name",convertDoname(E));B.find("div.name").text(E);sendMessage("alert-"+D.type,D.message)}})},removeDepartment:function(B){addEventO(B,"click",function(){f("#confirmDiv").confirmModal({heading:"Question",body:"Do you really want to remo this department?",type:"question",text:"Delete",cancel:true,callback:function(){b={};b.action="delete",b.form=f(o.userForm).serializeArray();b.id=f(B).attr("data-id");b.users=[];var D=f(z.departmentList).find("li.selected");var C=f(o.myUsers).find('li[data-category="'+D.attr("data-object-name")+'"]');C.each(function(){b.users.push({id:this.id})});v.url="/crawl?/process/users/handelgroups/";v.data=b;var E=getJsonData(v);if(E){f("#bc").html("");f(o.myUsers).find("li.rootClass").removeClass("hidden, hiddenClass");f(z.departmentList).find("li.selected").remove();f(z.departmentList).find('li[data-object-name="viewAll"]').addClass("selected");p.init();d.init();e.init()}}})},true,_eventHandlers)},listDepartmentUsers:function(D){f(".mbcholder").removeClass("selected");f("#detailRow").remove();if(isSupported()){localStorage.Department=D.attr("data-object-name")}D.addClass("selected");c=0;var F=D.find(".name").html();var B=D.attr("data-object-name");var E=D.attr("data-object-id");var C=(B=="viewAll")?"Company all":((B=="notInList")?"<span>"+F+"</span>":'<span class="pull-left1"><a class="editable" id="department" data-type="text" data-pk="'+E+'" data-value="'+F+'" data-original-title="Rename">'+F+'</a></span><span class="btn pull-left1 btn-empty btn-dark" id="deleteDep" data-id="'+E+'"><i class="icon-trash"></i></span>');f("#bc").html(C);switch(B){case"viewAll":f(o.myUsers).find("li.rootClass").removeClass("hiddenClass hidden");break;case"notInList":f(o.myUsers).find("li.rootClass").removeClass("hiddenClass").filter(function(){return f(this).attr("data-category")!=="0"}).addClass("hiddenClass");break;default:f(o.myUsers).find("li.rootClass").removeClass("hiddenClass").filter(function(){return f(this).attr("data-category")!==B}).addClass("hiddenClass");this.editDepartment(document.getElementById("department"));this.removeDepartment(document.getElementById("deleteDep"));break}f(o.myUsers).find("li.rootClass.hiddenClass").appendTo(o.myUsers);l=0;u.sort()},updateGroupData:function(B){},departmentView:function(){b={};b.action=k.department[0],b.form=f(o.userForm).serializeArray();v.url="/crawl?/process/users/handelgroups/";v.data=b;var B=getJsonData(v);if(!B){return false}f(z.departmentList).html(tmpl("tmpl-userGroupList",B));f(o.myUsers).find("li.rootClass").removeClass("hiddenClass");this.gatherDepartments();u.sort()},gatherDepartments:function(){z.row=[];f(z.departmentList).find("li.mbcholder").each(function(){z.row.push({"data-object-id":f(this).attr("data-object-id"),"data-object-name":f(this).attr("data-object-name")})});f(z.departmentList).find("li.mbcholder").live("click",function(){d.listDepartmentUsers(f(this));d.addDND()});this.addDND()},addDND:function(){f(z.departmentList).find("li.mediaBox:not(.hiddenClass, hidden)").droppable(t)}};var p={index:1,init:function(){f(x.input).preventEnter();this.viewGroups();addEventO(x.addButton,"click",function(){var B={groupName:x.input.value||"",post:k.groups[3]};p.addGroup(B)},true,_eventHandlers)},addGroup:function(C){if(C.groupName==""){sendMessage("alert-warning","Give some text");return false}b={};b.action=C.post;b.form=f(o.userForm).serializeArray();b.groupname=C.groupName;v.url="/crawl?/process/users/handeltraininggroups/";v.data=b;var D=getJsonData(v);if(D.result.id){x.input.value="";var E=[];E.result=[];E.result.push({id:D.result.id,name:C.groupName,doname:convertDoname(C.groupName),badge:0});var B=tmpl("tmpl-trainingGroupList",E,true);f(x.groupList).append(B);f(x.groupList).find("li.mediaBox").tsort({attr:"data-object-name"});this.gatherGroups()}},editGroup:function(C){f.fn.editable.defaults.url="/crawl?/process/users/handeltraininggroups/";f.fn.editable.defaults.params=function(D){D.action="rename";D.form=f(o.userForm).serializeArray();return D};var B=f(x.groupList).find("li.selected");f(C).editable({success:function(D,E){if(E.match(/^\s+$/)===null&&E.length===0){sendMessage("alert-error","Give a name");return false}B.attr("data-object-name",convertDoname(E));B.find("div.name").text(E);sendMessage("alert-"+D.type,D.message)}})},removeGroup:function(B){addEventO(B,"click",function(){f("#confirmDiv").confirmModal({heading:"Question",body:"Do you really want to delete this training group?",type:"question",text:"Delete",cancel:true,callback:function(){b={};b.action=k.groups[1],b.form=f(o.userForm).serializeArray();b.id=f(B).attr("data-id");v.url="/crawl?/process/users/handeltraininggroups/";v.data=b;var C=getJsonData(v);if(C){f("#bc").html("");f(o.myUsers).find("li.rootClass").removeClass("hidden, hiddenClass");f(x.groupList).find("li.selected").remove();f(z.departmentList).find('li[data-object-name="viewAll"]').addClass("selected");p.init()}}})},false,_eventHandlers)},listGroupUsers:function(E){f("#detailRow").remove();f(".mbcholder").removeClass("selected");E.addClass("selected");c=1;var H=E.find(".name").html();var C=E.attr("data-object-name");var G=E.attr("data-object-id");var D=(C=="viewAll")?"":((C=="notInList")?"<span>"+H+"</span>":'<span class="pull-left"><a class="editable" id="group" data-type="text" data-pk="'+G+'" data-value="'+H+'" data-original-title="Rename">'+H+'</a></span><span class="btn btn-empty btn-dark" id="deleteGrp" data-id="'+G+'"><i class="icon-trash"></i></span>');f("#bc").html(D);var B=E.attr("data-member-list");var F=B.split(",");f(o.myUsers).find("li.rootClass").removeClass("hiddenClass").filter(function(){return F.indexOf(f(this).attr("id"))==-1}).addClass("hiddenClass");f(o.myUsers).find("li.rootClass.hiddenClass").appendTo(o.myUsers);this.editGroup(document.getElementById("group"));this.removeGroup(document.getElementById("deleteGrp"))},updateGroupData:function(B){},viewGroups:function(){b={};b.action=k.groups[0];b.form=f(o.userForm).serializeArray();v.url="/crawl?/process/users/handeltraininggroups/";v.data=b;var B=getJsonData(v);if(!B.result){return false}f(x.groupList).html(tmpl("tmpl-trainingGroupList",B));this.gatherGroups()},gatherGroups:function(){x.row=[];f(x.groupList).find("li.mbcholder").each(function(){x.row.push({"data-object-id":f(this).attr("data-object-id"),"data-object-name":f(this).attr("data-object-name")})});f(x.groupList).find("li.mbcholder").live("click",function(){p.listGroupUsers(f(this));p.addDND()});this.addDND()},addDND:function(){f(x.groupList).find("li.mediaBox:not(.hiddenClass, hidden)").droppable(t)}};m.init=function(){f.fn.editable.defaults.mode="inline";f.fn.editable.defaults.dataType="json";f.fn.editable.defaults.emptytext="Please, fill this";f.fn.editable.defaults.url="";f(z.departmentList).slimScroll({position:"left",height:"300px",allowPageScroll:false,width:"auto"});f(x.groupList).slimScroll({position:"right",height:"300px",allowPageScroll:false,width:"190px"});initAffix(s);f(o.upload).bind("change",function(B){if(/\.csv$/gi.test(f(this).val())==false){sendMessage("alert-warning","Only csv allowed")}else{f(o.fileupload).fileupload("send",{files:B.target.files||[{name:this.value}],fileInput:f(this),formData:{form:f(o.userForm).serialize()}})}f(this).val("")});d.init();p.init();e.init();r.init();u.init();f(o.selectionMenu).find("a").bind("click",function(B){B.preventDefault();o.select(f(this))});a.init();f(window).scroll(function(){if((f(window).scrollTop()==f(document).height()-f(window).height())&&j.isLazy){e.userView()}})};var t={tolerance:"pointer",accept:"li",hoverClass:"ui-state-highlight",greedy:true,drop:function(F,H){var I=f(this),D=I.attr("data-object-name"),J=I.find("div.name").text(),G=I.parent().attr("id"),B=f(o.myUsers).find("li.selected:not(.hiddenClass, hidden)");var C={action:"",users:[],form:f(o.userForm).serializeArray(),groupid:I.attr("data-object-id"),groupname:J};B.each(function(K,L){C.users.push(f(this).attr("id"))});v.url="";switch(G){case"usersGroupList":v.url="/crawl?/process/users/handelgroups/";C.action=k.department[4];break;case"trainingGroupList":v.url="/crawl?/process/users/handeltraininggroups/";C.action=k.groups[4];break}v.data=C;var E=getJsonData(v);if(E){f("#draggingContainer2").animate({width:["toggle","swing"],height:["toggle","swing"],opacity:"toggle"},700,"linear",function(){if(G=="usersGroupList"){B.each(function(K,L){f(L).find("span.department").text(J);f(L).attr("data-category",D)})}f("#draggingContainer2").remove();f(o.myUsers).find(".selected").each(function(){e.userSelect(f(this))})});switch(G){case"usersGroupList":d.init();break;case"trainingGroupList":p.init();break}}return false}}}(window.userManager=window.userManager||{},jQuery));
var openedClass="icon-eye-close opener";var closedClass="icon-eye-open opener";var scrollContainerHeight=425;var scrollContainerInnerHeight=350;var selectedClass="selected";var xpos;var ypos;var sortTriggered=false;var totalFiles,uploadLimit,maxFiles=200;var popoverContent2=function(c){if(type!=="image"){switch(type){case"video":if(mediaType=="remote"){var b=parseVideoURL(mediaUrl);html='<iframe width="292px" height="150px" src="http://www.youtube.com/embed/'+b.id+'?fs=1&feature=oembed" frameborder="0" allowfullscreen></iframe>'}else{if(mediaType=="local"){var f=mediaUrl.substring(0,mediaUrl.lastIndexOf("."));res.result.push({name:c.attr("data-name"),poster:c.find("img").attr("src"),videoWidth:c.attr("data-video-width"),videoHeight:c.attr("data-video-height")});html=tmpl("tmpl-video",res)}}break;case"audio":var f=mediaUrl.substring(0,mediaUrl.lastIndexOf("."));res.result.push({name:f});html=tmpl("tmpl-audio",res);break}var d=c.find(".subdetails");var e="";if(d.find("span").length){e='<table class="table table-striped">';d.find("span").each(function(){e+="<tr><td>"+$(this).attr("class")+"</td><td>"+$(this).html()+"</td></tr>"});e+="</table>"}return html+e}else{var a=new Image();a.src=mediaUrl;a.onload=function(){var g=c.find(".subdetails");var h="";if(g.find("span").length){h='<table class="table table-striped">';g.find("span").each(function(){h+="<tr><td>"+$(this).attr("class")+"</td><td>"+$(this).html()+"</td></tr>"});h+="</table>"}html='<img src="'+a.src+'" />'+h;return html};var d=c.find(".subdetails");var e="";if(d.find("span").length){e='<table class="table table-striped">';d.find("span").each(function(){e+="<tr><td>"+$(this).attr("class")+"</td><td>"+$(this).html()+"</td></tr>"});e+="</table>"}html='<img src="'+a.src+'" />'+e;return html}};var popoverContent=function(e){var a=e.attr("data-mediaurl");mediaType=e.attr("data-mediatype"),type=e.attr("data-category");var c="",b=[];b.result=[];switch(type){case"video":if(mediaType=="remote"){var d=parseVideoURL(a);c='<iframe width="292px" height="150px" src="http://www.youtube.com/embed/'+d.id+'?fs=1&feature=oembed" frameborder="0" allowfullscreen></iframe>'}else{if(mediaType=="local"){var h=a.substring(0,a.lastIndexOf("."));b.result.push({name:e.attr("data-name"),poster:e.find("img").attr("src"),videoWidth:e.attr("data-video-width"),videoHeight:e.attr("data-video-height")});c=tmpl("tmpl-video",b)}}break;case"audio":var h=a.substring(0,a.lastIndexOf("."));b.result.push({name:h});c=tmpl("tmpl-audio",b);break}var f=e.find(".subdetails");var g="";if(f.find("span").length){g='<table class="table table-striped">';f.find("span").each(function(){g+="<tr><td>"+$(this).attr("class")+"</td><td>"+$(this).html()+"</td></tr>"});g+="</table>"}return c+g};var popoverPlacement=function(b){var a=$(b).offset();if(a.left<300){return"right"}else{if(a.left>900){return"left"}}if(a.top<350){return"bottom"}return"top"};var popoveroptions={placement:function(a,b){return popoverPlacement(b)},trigger:"manual",html:true,title:function(){return $(this).closest("li.mediaElement").attr("data-name")},content:function(){return popoverContent($(this).closest("li.mediaElement"))}};(function(l,g,h){var m={form:document.getElementById("mymediaForm")||"",mediaList:document.getElementById("myMediaList")||""},q={input:document.getElementById("newMBName")||"",addButton:document.getElementById("createNew")||"",groupList:document.getElementById("mediaBoxList"),container:document.getElementById("myMediaBoxesContainer")||"",groups:document.getElementsByClassName("mbcholder")||""},c={diskAreaButton:document.getElementById("diskAreaButton")||""},f={addButton:document.getElementById("addFiles")||"",init:function(){this.initAddFilesButton();this.sortingElements.init()},initAddFilesButton:function(){addEventO(f.addButton,"click",function(w){r.$content.toggleClass("open closed");r.$content.contentHeight=r.$content.outerHeight();if(r.$content.hasClass("closed")){r.$content.removeClass("transitions").css("max-height",r.$content.contentHeight);setTimeout(function(){r.$content.addClass("transitions").css({"max-height":0,opacity:0})},10)}else{if(r.$content.hasClass("open")){r.$content.contentHeight+=r.$content.inner.outerHeight();r.$content.css({"max-height":r.$content.contentHeight,opacity:1})}}g("#loading").hide().find(".loadingMessage").text(r.messages[1])},true,_eventHandlers)},sortingElements:{$sortbyButtons:g("#sortBy > button")||"",$sortby:g("#sortBy")||"",$wordFilterButton:g("#filterWord")||"",$orderButtons:g("#sortOrder > button")||"",$order:g("#sortOrder")||"",$filterButtons:g("#filters > button")||"",order:"asc",init:function(){this.$wordFilterButton.bind("keyup",function(){if(g(this).val().length<2){g(m.mediaList).find("li").removeClass("hiddenClass");return false}var w=g(this).val().toLowerCase();g(m.mediaList).find("li").filter(function(){return g(this).attr("data-name").toLowerCase().indexOf(w)==-1}).addClass("hiddenClass");f.sortingElements.sort()});this.$filterButtons.bind("click",function(y){y.preventDefault();g(this).hasClass("active")?g(this).removeClass("active"):g(this).addClass("active");g(m.mediaList).find("li").removeClass("hiddenClass");var w=g(this).attr("isotope-data-filter").replace(/\./g,"");if(w!=="all"){var x=g(m.mediaList).find("li").filter(function(){return w.indexOf(g(this).attr("data-category"))==-1});x.toggleClass("hiddenClass")}f.sortingElements.sort()});this.$sortbyButtons.bind("click",function(w){w.preventDefault();g(f.sortingElements.$sortby).find("button").removeClass("active");g(this).addClass("active");f.sortingElements.sort()});this.$orderButtons.bind("click",function(w){w.preventDefault();f.sortingElements.$order.find("button").removeClass("active");g(this).addClass("active");f.sortingElements.sort()});f.sortingElements.sort()},sort:function(){var y=g("#sortBy").find(".btn.active").attr("data-option-value");var w=g("#sortOrder").find(".btn.active").attr("data-option-value");var x=[];f.sortingElements.$filterButtons.filter(function(){return !g(this).hasClass("active")}).each(function(){x.push("colorBar "+g(this).attr("data-option-value"))});g(m.mediaList).find("li > .colorBar").filter(function(){return x.indexOf(this.className)!==-1}).parent().addClass("hiddenClass");g(m.mediaList).find("li:not(.hiddenClass, .hidden)").tsort({attr:"data-"+y,order:w});g(m.mediaList).find("li.hiddenClass, li.mediaElement.hidden").appendTo(m.mediaList)}}},r={uploadWidget:document.getElementById("fileupload")||"",container:document.getElementById("uploadContainer")||"",uploadFinishButton:document.getElementById("uploadFinish")||"",addVideoLinkButton:document.getElementById("addVideoLink")||"",filesLeft:document.getElementById("filesLeft")||"",$content:g("#content")||"",messages:{0:"Upload & conversation in progress...",1:"Loading in progress..."},init:function(){this.initUploadWidget();this.setUploadLimit();this.$content.inner=g(this.$content).find(".inner");g(this.$content).on("transitionEnd webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(w){if(r.$content.hasClass("open")){r.$content.css("max-height","360px")}});addEventO(r.uploadFinishButton,"click",function(x){if(g(r.container).find("li.template-download").length==0){g(f.addButton).trigger("click");return false}g("#loading").hide().find(".loadingMessage").text(r.messages[1]);var w=[];g(r.container).find("li.template-download").each(function(y,z){g(this).filter(function(){return !g(this).hasClass("error")?w.push({type:g(this).attr("data-category"),mediatype:g(this).attr("data-mediatype"),name:g(this).attr("data-name"),uploaded_ts:g(this).attr("data-uploaded"),uploaded:g(this).find("span.uploaded").text(),thumbnail_url:g(this).find("img").attr("src"),mediaurl:g(this).attr("data-mediaurl"),additional:g(this).find("span.additional").text(),size:g(this).attr("data-video-width")+","+g(this).attr("data-video-height")}):""})});if(g(r.container).find("li.template-download").length>0){r.saveMediaFiles(w,"local");g(r.container).empty()}r.setUploadLimit();g(f.addButton).trigger("click")},true,_eventHandlers);addEventO(r.addVideoLinkButton,"click",function(B){if(g(this).hasClass("disabled")){return false}var x=false;var z=null;var y={};g("#youtube").live("blur",function(){var C=g(this).val();z=parseVideoURL(C);if(!z){return false}if(x==false&&z){g("#video").html("").append('<iframe width="100%" height="100%" src="'+z.urlType+"www.youtube.com/embed/"+z.id+'?fs=1&feature=oembed" frameborder="0" allowfullscreen></iframe>');y=r.getYouTubeInfo(z.id);x=true}});var A=[];A.result=[];A.result.push({provider:"",id:"",title:"",desc:""});var w=tmpl("tmpl-videolink",A,false);g("#confirmDiv").confirmModal({heading:"Add video link",body:w,text:"Add video",type:"question",cancel:true,callback:function(){var F=[],E=Math.round(new Date().getTime()/1000),D=new Date,C;C=D.customFormat("#YYYY#.#MM#.#DD#.");F.push({type:"video",mediatype:"remote",name:g("#ytTitle").val(),uploaded_ts:E,uploaded:C,thumbnail_url:z.urlType+"img.youtube.com/vi/"+z.id+"/hqdefault.jpg",mediaurl:z.urlType+"www.youtube.com/watch?v="+z.id+"/",duration:secondsToTime(y.duration)});r.saveMediaFiles(F,"remote");return false}})},true,_eventHandlers)},saveMediaFiles:function(x,w){b={};b.action=k.mediafiles[3];b.type=w;b.form=g(m.form).serializeArray();b.diskArea=t.diskAreaId;b.files=x;u.url="/crawl?/process/mymedia/handelmediafiles/";u.data=b;var y=getJsonData(u);if(!y){return false}g(m.mediaList).append(tmpl("tmpl-mediaElement",y));f.sortingElements.sort();p.setPopover();this.setUploadLimit()},setUploadLimit:function(){s=g(m.mediaList).find("li.mediaElement").length;d=(j-s)>0?j-s:0;g(r.uploadWidget).fileupload("option","maxNumberOfFiles",d);r.filesLeft.innerHTML=d},destroyUploadWidget:function(){g(r.uploadWidget).fileupload("destroy")},initUploadWidget:function(){g(r.uploadWidget).fileupload({url:"/crawl?/process/upload/",filesContainer:g(r.container)});g(r.uploadWidget).fileupload("option",{maxNumberOfFiles:1,url:"/crawl?/process/upload/",maxFileSize:1200000000,previewMaxWidth:150,previewMaxHeight:100,acceptFileTypes:/(\.|\/)(gif|jpe?g|png|pdf|xls?|doc?|swf|ogg|flv|mp4|wmv|mp3|ppt?)$/i,process:[{action:"load",fileTypes:/^image\/(gif|jpeg|png)$/,maxFileSize:20000000},{action:"resize",maxWidth:1920,maxHeight:1200,minWidth:800,minHeight:600},{action:"save"}]}).bind("fileuploadadd",function(x,w){}).bind("fileuploadchange",function(x,w){g.each(w.files,function(y,z){var A=z.type.match(/(word|excel|powerpoint|pdf)/gi);w.files[y].typeShort=A})}).bind("fileuploadsubmit",function(x,w){g("#loading").show().find(".loadingMessage").text(r.messages[0])}).bind("fileuploaddone",function(x,w){g("#loading").hide().find(".loadingMessage").text(r.messages[1])}).bind("fileuploadstop",function(w){g("#loading").hide().find(".loadingMessage").text(r.messages[1])}).bind("fileuploadfail",function(x,w){g("#loading").hide().find(".loadingMessage").text(r.messages[1])})},getYouTubeInfo:function(w){var y=false;var x={};g.ajaxSetup({async:false});g.getJSON("http://gdata.youtube.com/feeds/api/videos/"+w+"?v=2&alt=jsonc",function(z){x.title=z.data.title;x.desc=z.data.description;x.author=z.data.uploader;x.updated=z.data.updated;x.duration=z.data.duration;r.parseresults(z)});return x},parseresults:function(w){g("#ytTitle").val(w.data.title);g("#ytDesc").val(w.data.description);g("#ytAuthor").val(w.data.uploader);g("#ytUploaded").val(w.data.updated)}},a={buttonGroup:document.getElementsByClassName("optionButtons")||"",selectedCount:document.getElementById("selectedCount")||"",$optionButton:g(".optionButtons").find("button")||"",init:function(){this.$optionButton.bind("click",function(){if(g(this).hasClass("disabled")){return false}var x=g(this).attr("data-option-value");var y=[];g(m.mediaList).find("li.selected:not(.hidden, hiddenClass)").each(function(){y.push({id:g(this).attr("data-id"),name:g(this).attr("data-name")})});var w=g(m.mediaList).find("li.selected:not(.hidden, .hiddenClass)");a.setAction(x,w,y);p.countSelected()})},setAction:function(x,w,y){switch(x){case"delete":p.deleteFiles(w,y);break;case"removefrom":p.removeFromGroup(w,y);break}}},e={selectionMenu:document.getElementById("selectionMenu")||"",select:function(w){switch(w.attr("class")){case"selectall":g(m.mediaList).find("li.mediaElement:not(.hiddenClass, .hidden)").addClass("selected").find(".icon-ok").addClass("icon-white");break;case"deselectall":g(m.mediaList).find("li.mediaElement:not(.hiddenClass, .hidden)").removeClass("selected").find(".icon-ok").removeClass("icon-white");break;case"invertselection":g(m.mediaList).find("li.mediaElement:not(.hiddenClass, .hidden)").toggleClass("selected").find(".icon-ok").toggleClass("icon-white");break}p.countSelected()}},b={},u={url:"",data:b,responseType:"json"},k={mediafiles:{0:"load",1:"delete",2:"rename",3:"add",4:"addto",5:"removefrom"},groups:{0:"load",1:"delete",2:"rename",3:"add"},diskArea:{0:"load",1:"delete",2:"rename",3:"new"}},n={0:q.input},o={0:q.container},s=0,j=200,d=200,v={};var p={init:function(){this.viewFiles();this.addDND()},viewFiles:function(){b={};b.action=k.mediafiles[0];b.form=g(m.form).serializeArray();b.diskArea=t.diskAreaId;u.url="/crawl?/process/mymedia/handelmediafiles/";u.data=b;var w=getJsonData(u);if(!w){return false}g(m.mediaList).append(tmpl("tmpl-mediaElement",w));g(m.mediaList).find(".selectButton").live("click",function(){var x=g(this).closest("li.mediaElement");p.selectFiles(x)});p.setPopover()},selectFiles:function(w){w.find(".icon-ok").toggleClass("icon-white");w.toggleClass("selected");this.countSelected();this.addDND()},hideAllPopovers:function(){g(".popover").each(function(){g(this).popover("hide");g(this).remove()})},setPopover:function(){g("li.mediaElement").live("click",function(y){y.stopPropagation();var w=["AUDIO"];var x=(y.target?y.target:y.srcElement);if(x.tagName.indexOf(w)==-1){g(".popover").remove().end();return false}});g(m.mediaList).on("click","span.detailButton",function(){var x=this,w=new Image();g(x).popover("destroy");p.hideAllPopovers();if(g(x).closest("li.mediaElement").data("category")=="image"){var y=g(x).closest("li.mediaElement").find(".subdetails");var z="";if(y.find("span").length){z='<table class="table table-striped">';y.find("span").each(function(){z+="<tr><td>"+g(this).attr("class")+"</td><td>"+g(this).html()+"</td></tr>"});z+="</table>"}w.src=g(this).closest("li.mediaElement").attr("data-mediaurl");w.onload=function(){var B=popoverPlacement(x);var A='<img src="'+w.src+'" />'+z;g(x).popover({content:A,html:true,placement:B,selector:x,title:function(){return g(this).closest("li.mediaElement").attr("data-name").substring(0,40)}});g(x).popover("show")}}else{if(g(this).parent().find(".popover").length==1){g(".popover").remove().end();return false}g(x).popover(popoveroptions);g(x).popover("show").on(function(A){g(x).append(g(".popover"));g(this).bind("click",function(){p.hideAllPopovers()})})}return false})},countSelected:function(){var w=g(m.mediaList).find("li.selected").length;g(a.selectedCount).text(w);if(!w){a.$optionButton.addClass("disabled");g(q.groupList).find("li.selected").attr("data-object-id")=="viewAll"?g(a.buttonGroup).find('button[data-option-value="removefrom"]').addClass("disabled"):g(a.buttonGroup).find('button[data-option-value="removefrom"]').removeClass("disabled")}else{a.$optionButton.removeClass("disabled");g(q.groupList).find("li.selected").attr("data-object-id")=="viewAll"?g(a.buttonGroup).find('button[data-option-value="removefrom"]').addClass("disabled"):g(a.buttonGroup).find('button[data-option-value="removefrom"]').removeClass("disabled")}},deleteFiles:function(C,B){var w,x=[],A=[];A.result=[];g.each(C,function(D,E){x.push({name:g(E).attr("data-name"),id:g(E).attr("data-id"),type:g(E).attr("data-category"),mediatype:g(E).attr("data-mediatype"),mediabox:g(E).attr("data-mediabox")})});for(var z=0;z<x.length;z++){A.result.push({mediaelement:x[z].name,id:x[z].id,textid:x[z].name.toLowerCase().latinize().substring(0,4),mediatype:x[z].mediatype,type:x[z].type,groupname:clearNULL(g(q.groupList).find('li[data-object-id="'+x[z].mediabox+'"]').attr("data-object-name")),did:t.diskAreaId})}A.result.sort(dynamicSort("textid"));var y=p.checkBeforeDelete(A.result);if(!y){w=tmpl("tmpl-emptytrash",A)}else{w=tmpl("tmpl-emptytrash",A);w+=tmpl("tmpl-emptytrash2",y)}g("#confirmDiv").confirmModal({heading:"Delete selected media",body:w,text:"Delete",cancel:true,callback:function(){b={};b.action=k.mediafiles[1];b.form=g(m.form).serializeArray();b.files=A.result;b.slides=y.result;u.url="/crawl?/process/mymedia/handelmediafiles/";u.data=b;var F=getJsonData(u);for(var E=0,D;D=A.result[E];E++){g(m.mediaList).find('li[data-id="'+D.id+'"]').remove()}f.sortingElements.sort();p.countSelected()}})},checkBeforeDelete:function(x){b={};b.check=x;b.form=g(m.form).serializeArray();u.url="/crawl?/process/mymedia/checkfiles/";u.data=b;var w=getJsonData(u);return w},addToGroup:function(w,y,z){b={};b.action=k.mediafiles[4];b.form=g(m.form).serializeArray();b.files=z;b.groupid=w;u.url="/crawl?/process/mymedia/handelmediafiles/";u.data=b;var x=getJsonData(u);if(!x){return false}g.each(y,function(){g(this).attr("data-mediabox",w)})},removeFromGroup:function(y,z){b={};b.action=k.mediafiles[5];b.form=g(m.form).serializeArray();b.files=z;u.url="/crawl?/process/mymedia/handelmediafiles/";u.data=b;var x=getJsonData(u);if(!x){return false}g.each(y,function(){g(this).attr("data-mediabox","0")});var w=g(q.groupList).find("li.mbcholder.selected");i.listSelectedGroupFiles(w.attr("data-object-id"))},addDND:function(){g(m.mediaList).find("li.mediaElement:not(.hidden, .hiddenClass)").draggable(this.myMediaDragOption)},myMediaDragOption:{appendTo:"body",distance:10,handle:".thumbnail",greedy:true,revert:true,opacity:0.7,helper:function(y,z){g(this).addClass("selected");var x=g(m.mediaList).find("li.selected:not(.hidden, .hiddenClass)");if(x.length===0||x.length===1){x=g(this)}p.countSelected();if(g("#draggingContainer2").length===0){var w=g('<ul class="span2 thumbnails" />').appendTo("body").attr("id","draggingContainer2")}else{w=g("#draggingContainer2");w.empty()}w.append('<li class="mediaElement span2 lightgreyB"><div class="thumbnail"><h1>'+x.length+" selected</h1></div></li>").css({position:"",left:"",top:"","z-index":"10000"});return w},start:function(w,x){g("#draggingContainer2").css({position:"absolute"})},stop:function(w,x){var y=x.position;y=Math.abs(y.left)}}};var t={messages:{0:"Fatal error! Main data is missing. Please reload the page"},diskAreaId:"",setDiskAreaId:function(w){this.diskAreaId=w},checkDiskAreaId:function(){this.setDiskAreaId(g(m.form).find('input[name="diskArea_id"]').val());if(this.diskAreaId===""){sendMessage("alert-error",this.messages[0]);l.destroy();return false}else{return t.diskAreaId}},init:function(){this.checkDiskAreaId();this.load();this.changeDiskArea()},load:function(){b={};b.action=k.diskArea[0];b.form=g(m.form).serializeArray();u.url="/crawl?/process/mymedia/loadfolder/";u.data=b;var y=getJsonData(u);if(!y){return false}g(".selectediskArea li.area").remove().end();var w=tmpl("tmpl-newDA",y);var x=g(".selectediskArea li.divider");g(w).insertBefore(x);g('.selectediskArea [data-id="'+t.diskAreaId+'"]').parent().addClass("selected")},changeDiskArea:function(){g(".selectediskArea a").live("click",function(x){x.preventDefault();x.stopPropagation();var w=g(c.diskAreaButton).attr("data-sortname");var z=g(this).attr("data-sortname");if(z==w){return false}g("#bc").empty();var y=g(this).attr("data-id");c.diskAreaButton.firstChild.nodeValue=g(this).text();g(this).parent().siblings().removeClass("selected");g(this).parent().toggleClass("selected");g("#diskAreaButton").attr("data-sortname",z);g(m.form).find('input[name="diskArea_id"]').val(y);g(m.form).find('input[name="diskArea_name"]').val(z.replace(/#/g,""));t.setDiskAreaId(y)})}};var i={init:function(){this.viewGroups();this.addDND();addEventO(q.addButton,"click",function(){var w={groupName:q.input.value||"",post:k.groups[3]};i.addGroup(w)},true,_eventHandlers)},viewGroups:function(w){b={};b.action=k.groups[0];b.form=g(m.form).serializeArray();b.diskArea_id=t.diskAreaId;u.url="/crawl?/process/mymedia/handelmediagroups/";u.data=b;var x=getJsonData(u);if(!x){return false}g(q.groupList).html('<li class="viewAll mbcholder span2 selected" data-object-id="viewAll"><div class="mbHeader"><div class="name">view all</div><div class="pointer-right"></div></div></li>');g(q.groupList).append(tmpl("tmpl-mediaBoxList",x));this.initGroupSelection()},addGroup:function(x){if(x.groupName==""){sendMessage("alert-warning","Give some text");return false}b={};b.action=x.post,b.form=g(m.form).serializeArray();b.groupname=x.groupName;u.url="/crawl?/process/mymedia/handelmediagroups/";u.data=b;var y=getJsonData(u);if(y){q.input.value="";var z=[];z.result=[];z.result.push({id:y.result.id,name:x.groupName,doname:convertDoname(x.groupName),badge:0});var w=tmpl("tmpl-newMediaBox",z,true);g(q.groupList).append(w);g(q.groupList).find("li.mediaBox").tsort({attr:"data-object-name"});this.addDND();this.initGroupSelection()}},initGroupSelection:function(){g(q.groupList).find("li.mbcholder").die("click");g(q.groupList).find("li.mbcholder").live("click",function(){i.selectGroup(g(this))})},selectGroup:function(w){if(w.hasClass("selected")){return false}w.siblings().removeClass("selected");w.addClass("selected");this.listSelectedGroupFiles(w.attr("data-object-id"));p.countSelected();this.editGroup(w)},editGroup:function(x){g.fn.editable.defaults.url="/crawl?/process/mymedia/handelmediagroups/";g.fn.editable.defaults.params=function(A){A.action="rename";A.form=g(m.form).serializeArray();return A};var z=x.attr("data-object-id");var y=x.find("div.name");var w=y.text();if(z=="viewAll"){g("#bc").html("View all");return false}g("#bc").html('<span class="pull-left"><a class="editable" id="mbName_'+z+'" data-type="text" data-pk="'+z+'">'+w+'</a></span><span class="btn btn-empty btn-dark" id="deleteGrp" data-id="'+z+'"><i class="icon-trash"></i></span>');this.removeGroup(document.getElementById("deleteGrp"));g("#mbName_"+z).editable({success:function(A,B){if(B.match(/^\s+$/)===null&&B.length===0){sendMessage("alert-error","Give a name");return false}x.attr("data-object-name",convertDoname(B));x.find("div.name").text(B);sendMessage("alert-"+A.type,A.message)}})},removeGroup:function(w){addEventO(w,"click",function(){g("#confirmDiv").confirmModal({heading:"Question",body:"Do you really want to delete this mediabox?",type:"question",text:"Delete",cancel:true,callback:function(){b={};b.action=k.groups[1],b.form=g(m.form).serializeArray();b.id=g(w).attr("data-id");u.url="/crawl?/process/mymedia/handelmediagroups/";u.data=b;var x=getJsonData(u);if(x){g("#bc").html("");g(m.mediaList).find("li.mediaElement").removeClass("hidden");g(q.groupList).find("li.selected").remove();g(q.groupList).find('li[data-object-name="viewAll"]').addClass("selected");g(q.groupList).find('li[data-mediabox="'+g(w).attr("data-id")+'"]').attr("data-mediabox","0")}}})},false,_eventHandlers)},listSelectedGroupFiles:function(w){if(w=="viewAll"){g(m.mediaList).find("li.mediaElement").removeClass("hidden");f.sortingElements.sort()}else{g(m.mediaList).find("li.mediaElement").removeClass("hidden").filter(function(){return g(this).attr("data-mediabox")!==w}).addClass("hidden")}f.sortingElements.sort()},addDND:function(){g(q.groupList).find("li.mbcholder").droppable(this.mediaBoxDropOption)},mediaBoxDropOption:{tolerance:"pointer",accept:"#myMediaList li",hoverClass:"ui-state-highlight",greedy:true,drop:function(z,x){if(g(this).hasClass("selected")){return false}var y=[];g(m.mediaList).find("li.selected:not(.hidden, hiddenClass)").each(function(){y.push({id:g(this).attr("data-id"),name:g(this).attr("data-name")})});var w=g(m.mediaList).find("li.selected:not(.hidden, .hiddenClass)");p.addToGroup(g(this).attr("data-object-id"),w,y)}}};l.init=function(w){v=w;g("#loading").show();for(var x in n){g(n[x]).preventEnter()}t.init();f.init();r.init();a.init();g(r.container).slimScroll({height:"237px",allowPageScroll:false,width:"800px"});g(q.groupList).slimScroll({position:"left",height:"400px",allowPageScroll:false,width:"190px"});i.init();p.init();p.countSelected();g(".dropdown-toggle").dropdown();g(e.selectionMenu).find("a").bind("click",function(y){y.preventDefault();e.select(g(this))});g("#loading").hide();g.fn.editable.defaults.mode="inline";g.fn.editable.defaults.dataType="json";g.fn.editable.defaults.emptytext="Please, fill this";g.fn.editable.defaults.url=""};l.destroy=function(){r.destroyUploadWidget();delete window.MyMedia}}(window.MyMedia=window.MyMedia||{},jQuery));
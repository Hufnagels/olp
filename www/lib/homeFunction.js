var previewContainer='<div id="trainingFrame" class="hidden fullscreen_hide"><div class="colHeader"><h3 class="orangeT"><span class="btn btn-dark exit" id="exitPreview" data-type="preview">Exit</span><span class="btn btn-dark exit" id="gotoFullscreen" data-type="fullscreen">fullscreen</span><span class="slideshowName"></span><input type="hidden" id="auth_token" name="auth_token" value="" /><div class="progress badge btn-dark pull-right" style="color: white;padding: 10px;line-height: 5px;margin-right: 10px;margin-top: 7px;"></div></h3></div><div class="clearfix"></div><div class="iframeHolder"><iframe id="previewIframe" scrolling="no" frameborder="0" src="" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe></div></div>';if($("#trainingFrame").length){$("#peviewIframe").attr("src","")}(function(o,b,c){var s={wrapper:b("#wrapper")||"",modalWindow:b("#myDetails")||""},u={lastVisited:window.localStorage.getItem("Training:last")||"",form:document.getElementById("myForm")||""},k={myTrainingList:document.getElementById("myTrainingList")||"",trainingFrame:document.getElementById("trainingFrame")||"",exit:document.querySelectorAll(".exit")||"",$iframe:b("#previewIframe")||"",matches:document.querySelectorAll(".card")||"",slideshowName:document.getElementsByClassName("slideshowName")||""},j={container:document.getElementById("myusersGroupsContainer")||"",resultList:document.getElementById("trainingResultList")||""},n={feedback:document.getElementsByName("fastMessage")[0]||"",sendFeedbackButton:document.getElementById("sendFastMessage")||""},p={$sortbyButtons:b("#sortBy > button")||"",$sortby:b("#sortBy")||"",$wordFilterButton:b("#filterWord")||"",$orderButtons:b("#sortOrder > button")||"",$order:b("#sortOrder")||"",$filterButtons:b("#filters > button")||"",order:"asc",init:function(){this.$wordFilterButton.bind("keyup",function(){if(b(this).val().length<2){b(k.myTrainingList).find("li").removeClass("hiddenClass");return false}var x=b(this).val().toLowerCase();b(k.myTrainingList).find("li").filter(function(){return b(this).attr("data-name").toLowerCase().indexOf(x)==-1}).addClass("hiddenClass");p.sort()});this.$filterButtons.bind("click",function(z){z.preventDefault();b(this).hasClass("active")?b(this).removeClass("active"):b(this).addClass("active");b(k.myTrainingList).find("li").removeClass("hiddenClass");var x=b(this).attr("isotope-data-filter").replace(/\./g,"");if(x!=="all"){var y=b(k.myTrainingList).find("li").filter(function(){return x.indexOf(b(this).attr("data-category"))==-1});y.toggleClass("hiddenClass")}p.sort()});this.$sortbyButtons.bind("click",function(x){x.preventDefault();b(p.$sortby).find("button").removeClass("active");b(this).addClass("active");p.sort()});this.$orderButtons.bind("click",function(x){x.preventDefault();p.$order.find("button").removeClass("active");b(this).addClass("active");p.sort()});p.sort()},sort:function(){var z=b("#sortBy").find(".btn.active").attr("data-option-value");var x=b("#sortOrder").find(".btn.active").attr("data-option-value");var y=[];p.$filterButtons.filter(function(){return !b(this).hasClass("active")}).each(function(){y.push("colorBar "+b(this).attr("data-option-value"))});b(k.myTrainingList).find("li > .colorBar").filter(function(){return y.indexOf(this.className)!==-1}).parent().addClass("hiddenClass");b(k.myTrainingList).find("li:not(.hiddenClass, .hidden)").tsort({attr:"data-"+z,order:x});b(k.myTrainingList).find("li.hiddenClass, li.mediaElement.hidden").appendTo(k.myTrainingList)}},i={training:{0:"load"},statistic:{0:"load"}},l={0:j.container},q={},d=false,r="",m=true,f=[],a={},t={url:"",data:a,responseType:"json"};var h={init:function(){n.feedback.value="";addEventO(n.sendFeedbackButton,"click",function(){sendPostMessage("feedback",n.feedback);h.sendFeedback()},true,q)},sendPostMessage:function(z,x){var y=sendEmail(z,x.value,b(u.form).serializeArray());sendMessage("alert-"+y.type,y.message);if(y.type=="success"){x.value=""}event.preventDefault()},sendFeedback:function(){var x=sendEmail("feedback",n.feedback.value,b(u.form).serializeArray());sendMessage("alert-"+x.type,x.message);if(x.type=="success"){n.feedback.value=""}event.preventDefault()}};var v={init:function(){if(!u.lastVisited&&isSupported()){window.localStorage.setItem("Training:last",u.lastVisited=0)}k.$iframe.css({width:viewportWidth+"px",height:(viewportHeight-34)+"px"});this.loadTrainings();this.setActions()},loadTrainings:function(){a={};a.form=b(u.form).serializeArray();t.url="/crawl?/process/home/trainings/";t.data=a;var x=getJsonData(t);if(!x){return false}b(k.myTrainingList).html(tmpl("tmpl-trainingElement",x));k.openTrainingButtons=b(".trainingElement .btn");f=calculateLIsInRow(k.myTrainingList);k.matches=document.querySelectorAll(".card")},setActions:function(){b(".front").live("click",function(){v.selectItem(this)});for(var x=0;x<k.exit.length;x++){var y=k.exit[x];addEventO(y,"click",v.exitTraining,true,q)}},selectItem:function(x){this.displayDetailRow(x)},displayDetailRow:function(z){var x=b(z).closest("li");var B=parseInt(x.index()/f[1])+1;var y=x.position().left-x.parent().position().left+85+"px";a={};a.training_id=x.attr("id");t.data=a;t.url="/crawl?/process/home/trainingdetails/";t.responseType="html";var A=getJsonData(t);if(!A){return false}b(s.modalWindow).find(".modal-header h4").html(x.attr("isotope-title"));b(s.modalWindow).find(".modal-body").html(A);b(s.modalWindow).modal("show");b(".openSlideshowButton:not(.disabled)").live("click",function(){b("#myDetails").modal("hide");v.openTraining(this)})},openTraining:function(A){var y=b(A).attr("data-id"),B=b(A),x=b(A).attr("data-sid"),z=B.attr("isotope-author")+" - "+B.attr("isotope-title");k.trainingFrame.className=" fullscreen_show";b(s.wrapper).addClass("hiddenClass");viewportWidth=w.innerWidth||e.clientWidth||g.clientWidth;viewportHeight=w.innerHeight||e.clientHeight||g.clientHeight;var C="id"+(new Date()).getTime();k.$iframe.attr("src",SUBDOMAIN+y+"/"+x+"/?tokenId="+C).css({width:viewportWidth+"px",height:viewportHeight+"px"});b("#auth_token").val(C);k.$iframe[0].contentWindow.focus();if(isSupported()){window.localStorage.setItem("Training:last",u.lastVisited=y)}},flipItem:function(x){if(b(x).hasClass("flip")){if(e.target.tagName=="A"){window.open(e.target.href);e.preventDefault()}else{b(x).removeClass("flip")}}else{if(e.target.tagName=="A"){window.open(e.target.href);e.preventDefault()}else{b(x).addClass("flip")}}},exitTraining:function(A){switch(A.target.getAttribute("data-type")){case"preview":b("#trainingFrame").attr("class"," fullscreen_hide hide");b(s.wrapper).removeClass("hiddenClass");cancelFullscreen(document);k.$iframe.attr("src","");if(isSupported()){r=window.localStorage.getItem("Training:last")}if(!b(k.myTrainingList).find('li[id="'+r+'"]').attr("isotope-status")=="solved"){b(k.myTrainingList).find('li[id="'+r+'"]').find(".colorBar").attr("class","colorBar solved");var x=b(j.resultList).find(".name > .count").text(),y=b(j.resultList).find(".badge1 > .count"),z=b(j.resultList).find(".bar");y.text(parseInt(y.text())+1);z.css("width",(parseInt(y.text())+1)/(parseInt(x))*100+"%")}r="";break;case"screen":case"fullscreen":toggleFullscreen();break}}};o.destroy=function(){o.preinit();delete window.myTraining};o.preinit=function(){b(k.myTrainingList).empty();b(j.resultList).empty();n.feedback.value="";removeAllEventsByEvent("click",q)};o.init=function(){o.preinit();initAffix(l);v.init();$window.resize(function(x){viewportWidth=w.innerWidth||x.clientWidth||g.clientWidth;viewportHeight=w.innerHeight||x.clientHeight||g.clientHeight;if(!b(".row.special").hasClass("hiddenClass")){f=calculateLIsInRow(k.myTrainingList)}if(window.screenTop&&window.screenY){k.$iframe.css({width:viewportWidth+"px",height:(viewportHeight-34)+"px"})}else{k.$iframe.css({width:viewportWidth+"px",height:(viewportHeight-34)+"px"})}})}}(window.myTraining=window.myTraining||{},jQuery));